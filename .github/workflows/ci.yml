name: ci

on:
  pull_request:
    branches:
      - "main"
      - "master"
  push:
    branches:
      - "main"
      - "master"

jobs:

  docker:
    uses: ./.github/workflows/docker.yml
    secrets: inherit
    with:
      cache_from: |
        docker.io/klutchell/dnscrypt-proxy:main
        ghcr.io/klutchell/dnscrypt-proxy:main
        docker.io/klutchell/dnscrypt-proxy:latest
        ghcr.io/klutchell/dnscrypt-proxy:latest
      images: |
        docker.io/klutchell/dnscrypt-proxy
        ghcr.io/klutchell/dnscrypt-proxy
      platforms: |
        linux/amd64
        linux/arm64
        linux/arm/v7
        linux/arm/v6
      dockerhub_description_repo: klutchell/dnscrypt-proxy
